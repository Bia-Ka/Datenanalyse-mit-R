---
title: "Einführung in Daten"
author: "Karsten Lübke"
date: ''
<<<<<<< HEAD
output: github_document
=======
output:
  github_document
>>>>>>> master
documentclass: article
classoption: a4paper
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(mosaic)
require(corrgram)
```
## Datensatz

Wir werden jetzt den *tips* Datensatz aus *Bryant, P. G. and Smith, M (1995) Practical Data Analysis: Case Studies in Business Statistics. Homewood, IL: Richard D. Irwin Publishing* näher analysieren.

<<<<<<< HEAD
Sofern noch nicht geschehen, können Sie in [hier](https://goo.gl/whKjnl) als `csv`-Datei herunterladen:
=======
Sofern noch nicht geschehen, können Sie in als `csv` Datei herunterladen:
>>>>>>> master
```{r eval=FALSE}
download.file("https://goo.gl/whKjnl", destfile = "tips.csv")
```

<<<<<<< HEAD
```{r, echo = FALSE}
tips <- read.csv2("../../Daten/tips.csv")
```


Das Einlesen erfolgt, sofern die Daten im Arbeitsverzeichnis liegen, über:
```{r, eval = FALSE}
tips <- read.csv2("tips.csv")
```
*Tipp:* Wenn Sie nicht mehr wissen, wo die Daten liegen: statt `"tips.csv"` den Befehl `file.choose()` als Argument für die Funktion `read.csv2` verwenden.
=======
Das Einlesen erfolgt, sofern die Daten im aktuellen Verzeichnis liegen, über:
```{r}
tips <- read.csv2("tips.csv")
```
*Tipp:* Wenn Sie nicht mehr wissen wo die Daten liegen: statt `tips.csv` den Befehl `file.choose()` als Argument für die Funktion `read.csv2` verwenden.
>>>>>>> master

Inwieweit das Einlesen wie gewünscht geklappt hat, kann über
```{r eval=FALSE}
str(tips)
```
<<<<<<< HEAD
überprüft werden: Der Datensatz hat also `r nrow(tips)` Zeilen (=Beobachtungen) und `r ncol(tips)` Spalten (=Merkmale/ Variablen).

Zur folgenden Analyse muss zunächst das Paket `mosaic` geladen werden:
```{r eval=FALSE}
=======
überprüft werden. Der Datensatz hat also `r nrow(tips)` Zeilen (=Beobachtungen) und `r ncol(tips)` Spalten (=Merkmale/ Variablen).

Zur folgenden Analyse muss zunächst das Paket `mosaic` geladen werden:
```{r eval=FALSE, message=FALSE}
>>>>>>> master
require(mosaic)

```


## Grafische Verfahren der Datenanalyse
Bevor evtl. wichtige Information in zusammenfassenden Kennzahlen verloren geht, versuchen wir einen Gesamtüberblick zu erhalten.

### Balkendiagramm
<<<<<<< HEAD
Balkendiagramme eignen sich am besten um Häufigkeiten darzustellen, also für kategorielle Variablen (`factor`) oder für metrische Variablen (`numeric`) mit wenigen Merkmalsausprägungen. 
=======
Balkendiagramme eignen sich für kategorielle Variablen (`factor`) oder für metrische Variablen (`numeric`) mit wenigen Merkmalsausprägungen. 
>>>>>>> master
Um einen Überblick über die Geschlechterverteilung `sex` zu bekommen kann die Funktion `bargraph` aus dem Paket `mosaic` verwendet werden:
```{r}
bargraph(~ sex, data=tips)
```

In mosaic wird (fast) immer die Formeldarstellung `y ~ x | z` verwendet: `y` wird modelliert durch `x` in Abhängigkeit der Werte von `z`, wobei einzelne Teile fehlen können, so wie im Beispiel `y` und `z`. Aber um z. B. die Verteilung des Geschlechts des Zahlenden je Tageszeit `time` darzustellen muss hier eingegeben werden:
```{r}
bargraph(~ sex | time, data=tips)
```

***
**Übung:** Zeichnen Sie ein Balkendiagramm des Rauchverhaltens `smoker` je Wochentag `day` und interpretieren Sie das Ergebnis.

***
<<<<<<< HEAD

=======
>>>>>>> master
### Histogramm
Histogramme werden für metrische Daten verwendet, der Befehl lautet `histogram`.

***
**Übung:** Welche Abbildung wird über
```{r eval=FALSE}
histogram(~ total_bill | sex, data=tips)
```
erzeugt?

***

<<<<<<< HEAD
**Punktdiagramme** sind eine Variante von Histogrammen, die besonders für metrische Variablen mit wenigen Merkmalsausprägungen geeignet sind.
=======
**Punkdiagramme** sind eine Variante von Histogrammen, die besonders für metrische Variablen mit wenigen Merkmalsausprägungen geeignet sind.
>>>>>>> master
```{r}
dotPlot(~ size, nint=6, data=tips)

```

<<<<<<< HEAD
Hier wurde ein zusätzliche Parameter der Funktion `dotPlot` übergeben: `nint=6`. Dieser Parameter wurde wurde verwendet, um die Abbildung schöner zu machen. Welche Optionen es gibt und was diese bedeuten, kann man in R häufig einfach über die Hilfe, hier also `?dotPlot`, erfahren.

### Boxplots
Boxplots zeigen nicht nur den Median (50%-Quantil) sowie das obere (75%) und untere (25%) Quartil - und damit den Interquartilsabstand -, sondern geben auch Hinweise auf potentielle Ausreißer:
=======
Hier wurden zusätzliche Parameter der Funktion `dotPlot` übergeben, `nint=6` u. Diese wurden verwendet um die Abbildung schöner zu machen. Welche Optionen es gibt und was diese bedeuten kann man in R häufig einfach über die Hilfe, hier also `?dotPlot` erfahren.

### Boxplots
Boxplots zeigen nicht nur den Median (50%-Quantil), sondern auch das obere (75%) und untere (25%) Quartil - und damit den Interquartilsabstand - sondern geben auch Hinweise auf potentielle Ausreißer:
>>>>>>> master
```{r}
bwplot(total_bill ~ sex, data=tips)
```

und gruppiert nach Tageszeit:
```{r}
bwplot(total_bill ~ sex | time, data=tips)
```

***
**Übung:** Zeichen Sie einen Boxplot für die Trinkgeldhöhe `tip` in Abhängigkeit davon, ob geraucht wurde `smoker`. Gibt es Unterschiede in der Trinkgeldhöhe, und wenn ja in welchem Bereich?

***


<<<<<<< HEAD
### Scatterplot (Streudiagramme)
Streudiagramme sind besonders gut geeignet, um einen Überblick auf den Zusammenhang zweier metrischer Merkmale zu erhalten; beispielsweise um den Zusammenhang von `tip` und `total_bill` zu analysieren.
=======
### Scatterplot
Streudiagramme sind besonders gut geeignet um einen ersten Blick auf den Zusammenhang zweier metrischer Merkmale zu erhalten. Beispielsweise um den Zusammenhang von `tip` und `total_bill` zu analysieren.
>>>>>>> master
```{r}
xyplot(tip ~ total_bill, data=tips)
```

Wenig überraschend steigt die Trinkgeldhöhe mit der Rechnung. Wie sieht es relativ aus?
Dazu müssen wir zunächst ein neues Merkmal im Datensatz erzeugen, z. B.:
```{r}
tips$tip_relativ <- tips$tip / tips$total_bill
```
Im Datensatz `tips` wird der (neuen) Variable `tip_relativ` der Quotient aus Trinkgeld und Rechnungshöhe zugewiesen.

***
**Übung:** Erstellen Sie eine Abbildung, mit der Sie visuell gucken können, wie der Zusammenhang zwischen der relativen Trinkgeldhöhe (abhängige Variable) und der Rechnungshöhe (uanbhängige Variable) aussieht, und ob sich dieser je nach Geschlecht des Rechnungszahlers unterscheidet.

***


### Mosaicplot
<<<<<<< HEAD
Mosaicplots eignen sich, um den Zusammenhang zwischen kategoriellen Variablen darzustellen. Zunächst müssen wir dazu eine Kreuztabelle erstellen. Das geht in `mosaic` über den Befehl `tally`. Dieser Befehl ist recht mächtig -- dazu später mehr. Wir erzeugen eine solche Kreuztabelle zwischen Tageszeit und Rauchen über
=======
Mosaicplots eignen sich, um den Zusammenhang zwischen kategoriellen Variablen darzustellen. Zunächst müssen wir dazu eine Kreuztabelle erstellen. Die geht in `mosaic` über den Befehl `tally`. Dieser ist recht mächtig -- dazu später mehr. Wir erzeugen eine solche Kreuztabelle zwischen Tageszeit und Rauchen über
>>>>>>> master
```{r}
tab_smoke_time <- tally(smoker ~ time, data=tips)
```

Dem (neuen) R Objekt `tab_smoke_time` wird also das Ergebnis des `tally` Befehls zugewiesen. Wie das Ergebnis aussieht, und welchen Typ es hat erfahren wir über
```{r}
print(tab_smoke_time)
str(tab_smoke_time)
```
Es handelt sich also um eine Tabelle (`table`) der Dimension `r dim(tab_smoke_time)`, also `r dim(tab_smoke_time)[1]` Zeilen, `r dim(tab_smoke_time)[2]` Spalten.

Der Befehl für einen Mosaicplot lautet `mosaicplot`:
```{r}
mosaicplot(tab_smoke_time)
```


### Korrelationsplot
<<<<<<< HEAD
Mit Hilfe des Zusatzpakets `corrgram` lassen sich Korrelationen besonders einfach visualisieren. Das Paket muss wie jedes Paket *einmalig* über
```{r eval=FALSE}
install.packages("corrgram")
```
installiert werden -- wiederum werden weitere benötigte Pakete mit-installiert.
Nach dem Laden des Pakets über
```{r eval=TRUE, message=FALSE}
=======
Mit Hilfe des Zusatzpakets `corrgram` lassen sich Korrelationen besonders einfach visualisieren. Die muss *einmalig* über
```{r eval=FALSE}
install.packages("corrgram")
```
installiert werden -- wiederum werden weitere Pakete mit-installiert.
Nach dem Laden des Pakets über
```{r eval=FALSE, message=FALSE}
>>>>>>> master
require(corrgram)
```
kann dies über
```{r}
corrgram(tips)
```

<<<<<<< HEAD
gezeichnet werden. Je intensiver die Farbe, desto höher die Korrelation. Hier gibt es unzählige Einstellmöglichkeiten, siehe `?corrgram` bzw. für Beispiele:
=======
gezeichnet werden. Je intensiver die Farbe, desto höher die Korrelation. Hier gibt es unzählige Einstellmöglichkeiten: `?corrgram`, bzw. für Beispiele:
>>>>>>> master
```{r eval=FALSE}
vignette("corrgram_examples")
```


## Kennzahlen der Datenanalyse
<<<<<<< HEAD
Nachdem wir einen ersten visuellen Eindruck gewonnen haben wollen, wir uns jetzt Kennzahlen widmen.
=======
Nachdem wir einen ersten visuellen Eindruck gewonnen haben wollen wir uns jetzt Kennzahlen widmen.
>>>>>>> master

### Lagemaße
Das Minimum und Maximum von metrischen Daten kann einfach durch `min` bzw. `max` bestimmt werden, in `mosaic` auch "modelliert":
```{r}
min(~ total_bill | smoker, data=tips)
```
gibt also das Minimum der Rechnungshöhe, getrennt nach Raucher und Nichtrauchern an, d. h. das Minimum bei den Rauchern lag bei `r min(~total_bill|smoker, data=tips)["Yes"]`$.

***
<<<<<<< HEAD
**Übung:** Bestimmen Sie das Maximum der Trinkgeldhöhe je 

***

Lagemaße sollen die zentrale Tendenz der Daten beschreiben. Gebräuchlich sind in der Regel der arithmetische Mittelwert `mean`
=======
**Übung:** Bestimmen Sie das Maximum der Trinkgeldhöhe je Geschlecht.

***
Die Meisten Lagemaße sollen die zentrale Tendenz der Daten beschreiben. Gebräuchlich sind in der Regel der arithmetische Mittelwert `mean`
>>>>>>> master
```{r}
mean(~ total_bill, data=tips)
```
sowie der Median `median`:
```{r}
median(~ total_bill, data=tips)
```

Diese unterscheiden sich:
```{r}
meantb <- mean(~ total_bill, data=tips) # Mittelwert
mediantb <- median(~ total_bill, data=tips) # Median
histogram(~ total_bill, v=c(meantb, mediantb), data=tips)
```

***
**Übung:** Begründen Sie anhand des Histogramms, warum hier der Median kleiner als der arithmetische Mittelwert ist.

***
<<<<<<< HEAD

Auch Lagemaße zu berechnen in Abhängigkeit der Gruppenzugehörigkeit ist einfach. So berechnet man den arithmetischen Mittelwert in Abhängigkeit von Geschlecht und Tageszeit:
=======
Auch Lagemaße in Abhängigkeit von Gruppen ist einfach. Bestimme den arithmetischen Mittelwert in Abhängigkeit von Geschlecht und Tageszeit:
>>>>>>> master
```{r}
mean(total_bill ~ sex + time, data=tips)
```

***
**Übung:** Bestimmen Sie den Median der Trinkgeldhöhe anhand der Anzahl Personen in der Tischgesellschaft.

***

Für kategorielle Variablen können eigentlich zunächst nur die Häufigkeiten bestimmt werden:
```{r}
tally(~day, data=tips)
```
<<<<<<< HEAD
Relative Häufigkeiten werden bei `mosaic` mit der zusätzlichen Option `format="proportion"` angefordert:
=======
Reaktive Häufigkeiten mit der zusätzlichen Option `format="proportion"`, de. H.:
>>>>>>> master
```{r}
tally(~day, format="proportion", data=tips)
```

### Streuungsmaße
Die Variation der Daten, die wir grafisch und auch in den (bedingten) Lagemaßen gesehen haben ist eines der zentralen Themen der Statistik: Können wir die Variation vielleicht erklären? Variiert die Rechnungshöhe vielleicht mit der Anzahl Personen?

<<<<<<< HEAD
Zur Bestimmung der Streuung werden in der Regel der Interquartilsabstand `IQR` sowie Varianz `var` bzw. Standardabweichung `sd` herangezogen:
=======
Zur Bestimmung der Streuung werden in der Regel der Interquartilsabstand `IQsR` sowie Varianz `var` bzw. Standardabweichung `sd` herangezogen:
>>>>>>> master
```{r}
IQR(~total_bill, data=tips)
var(~total_bill, data=tips)
sd(~total_bill, data=tips)
```

Um die Standardabweichung in Abhängigkeit der Gruppengröße zu berechnen genügt der Befehl:
```{r}
sd(~total_bill | size, data=tips)
```
<<<<<<< HEAD
Bei 4 Personen lag die Standardabweichung als bei `r round(sd(~total_bill|size, data=tips)["4"], 2)`$.
=======
Bei 4 Personen lag die Standardabweichung als bei `r sd(~total_bill|size, data=tips)["4"]`$.
>>>>>>> master

Um jetzt z. B. den Variationskoeffizienten zu berechnen wird 
```{r}
sd(~total_bill | size, data=tips) / mean(~total_bill | size, data=tips)
```
gebildet.

***
**Übung:** Zu welcher Tageszeit ist die Standardabweichung des Trinkgelds geringer? Zum Lunch oder zum Dinner?

***

Die *üblichen* deskriptiven Kennzahlen sind in `mosaic` übrigens in einer Funktion zusammengefasst: `favstats`:
```{r}
favstats(tip~day, data=tips)
```


### Zusammenhangsmaße
Kennzahlen für den linearen Zusammenhang von metrischen Variablen sind Kovarianz `cov` und der Korrelationskoeffizient `cor`:
```{r}
cov(tip, total_bill, data=tips)
cor(tip, total_bill, data=tips)
```

Für kategorielle Variablen wird in diesen Abschnitt zunächst nur die Kreuztabelle verwendet:
```{r}
tally(smoker~sex, format="proportion", data=tips)
```

***
**Übung:** Zu welcher Tageszeit wurde relativ häufiger von einer Frau die Rechnung bezahlt?

***
<<<<<<< HEAD

## Übung: Teaching Rating
Dieser Datensatz analysiert u. a. den Zusammenhang zwischen Schönheit und Evaluierungsergebnis von Dozenten:

*Hamermesh, D.S., and Parker, A. (2005). Beauty in the Classroom: Instructors' Pulchritude and Putative Pedagogical Productivity. Economics of Education Review, 24, 369–376.*

Sie können ihn von [https://goo.gl/6Y3KoK](https://goo.gl/6Y3KoK) herunterladen.
=======
## Übung: Teaching Rating
Dieser Datensatz analysiert u. a. den Zusammenhang zwischen Schönheit und Evaluierungsergebnis:

*Hamermesh, D.S., and Parker, A. (2005). Beauty in the Classroom: Instructors' Pulchritude and Putative Pedagogical Productivity. Economics of Education Review, 24, 369–376.*

Sie können ihn von `https://goo.gl/6Y3KoK` herunterladen.
>>>>>>> master


1.  Erstellen Sie ein Balkendiagramm der Variable `native` gruppiert nach der Variable `minority`.
2.  Erstellen Sie ein Histogramm der Variable `beauty` gruppiert nach der Variable `gender`.
3.  Vergleichen Sie das Evaluationsergebnis `eval` in Abhängigkeit ob es sich um einen Single-Credit Kurs `credits` handelt mit Hilfe eines Boxplots.
4.  Zeichnen Sie ein Scatterplot der Variable `eval` in Abhängigkeit der zu definierenden Variable "Evaluierungsquote": `students/allstudents`.
5.  Berechnen Sie deskriptive Kennzahlen der Variable `eval` in Abhängigkeit ob es sich um einen Single-Credit Kurs `credits` handelt.



***
Diese Übung basiert teilweise auf Übungen zum Buch [OpenIntro](https://www.openintro.org/stat/index.php?stat_book=isrs) von Andrew Bray und Mine &Ccedil;etinkaya-Rundel unter der Lizenz [Creative Commons Attribution-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-sa/3.0). 

### Versionshinweise:
* Datum erstellt: `r Sys.Date()`
* R Version: `r getRversion()`
* `mosaic` Version: `r packageVersion("mosaic")`
